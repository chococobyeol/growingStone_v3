# PRD: growingStone

## 1. 프로젝트 개요

PC 작업자를 위한 **과학 기반 절차적 생성 방치형 위젯 게임**이다.  
**Second Monitor Game / Desktop Companion** 장르(Rusty's Retirement 등)가 스팀에서 주목받는 시점에서, 틈새 시장을 노린 기획이다.

### 타겟 유저

- 개발자, 디자이너, 학생 등 PC 사용 시간이 길고 서브 모니터를 활용하는 성인 유저

### 핵심 철학

- **Scientific:** IMA(국제광물학회) 데이터 기반의 사실적 시뮬레이션
- **Fairness:** P2W(Pay to Win)가 없는 100% 인게임 경제
- **Zen:** 로그 함수 성장을 통한 느림의 미학(Slow Gaming)

### 플랫폼 전략

- **Steam / Epic Games Store:** Windows 전용, 편의성 제공 ($2 유료)
- **GitHub:** Windows/Mac/Linux 소스 코드 공개 (무료, 직접 빌드)

### 수익 모델 (BM)

- **1차:** 스팀/에픽 $2 판매 (서버비 방어용). $2만으로는 큰 수익 한계가 있음을 전제로 한다.
- **2차:** 제휴 마케팅(쿠팡 파트너스·아마존 어필리에이트 등). **기본 화면은 깨끗하게 유지**하며, **돌 상세 정보·도감 등 별도 메뉴**를 눌렀을 때만 "실물 표본 정보(Reference)" 버튼 등으로 구매 링크를 노출한다. 광고 배너가 아니라 **정보 제공** 느낌으로 설계.
- **3차(장기):** 팬덤 형성 시 실물 반려돌(실제 광물 표본·굿즈) 판매 검토.

---

## 2. 핵심 게임 진행 방식

### 위젯 방치형

- 게임은 **위젯** 형태로 동작한다. 사용자가 화면 한쪽에 두고 가만히 놔두기만 해도 진행된다.
- 별도 조작 없이 **시간이 흐를수록 돌이 성장**하는 방식이 핵심 루프이다.

### 성장 곡선: 로그 함수

- 성장은 **시간에 따라 무한정** 커진다.
- 단, **커지는 속도는 점점 둔화**되어야 한다. 즉 **로그 곡선(log curve)** 으로 성장한다.
- 예: `크기 = 초기크기 + ln(경과시간 + 1) × 계수` 형태. 초반에는 빠르게 커지다가, 시간이 갈수록 성장폭이 줄어드는 느림의 미학을 구현한다.
- **초반 이탈 방지:** 로그 함수 특성상 **시작 직후부터 이미 눈에 띄게 빠르게** 커진다. 별도의 튜토리얼 성장 가속은 두지 않는다.

### 성장 조건 (오프라인 미적용)

- **앱을 끈 동안에는 성장이 일어나지 않는다.** 앱이 실행 중일 때만 서버 시간이 흐르며, 그에 따라 질량/부피가 증가한다.

---

## 3. 합성과 분해

### 합성 (Synthesis)

- 유저가 **보유한 원소**를 재료로 사용한다.
- **합성 규모:** 기본은 **1개** 합성. 나중에 자원이 많으면 **개수 지정**으로 한 번에 여러 개 합성할 수 있도록 한다. (예: 1 / 3 / 5 … 회분 선택)
- **총량 고정 + 비율 → 자동 계산:** 광물마다 원소 비율이 다르면 필요한 개수가 복잡해지므로, **1회분당 “총 원소량”을 고정**하고, 선택한 레시피의 **비율만 지정**하면 시스템이 **그 비율로 총량을 나눠 각 원소 필요량을 자동 계산**하도록 한다. (유저는 레시피/비율만 고르면 됨.)
- **1회분 기준 총량:** 비율을 적용할 때 쓰는 “총량” 단위를 정해야 한다. **300**을 사용한다. 숫자가 작아 가독성이 좋다. 극단적으로 복잡한 화학식에서 일부 계수가 1 미만으로 나올 수 있으나, **소수점 이하 6자리**까지 표시하여 충분히 표현 가능하다.
- **합성 순서 (유지):**
  1. **구성 원소·비율 설정** — 주기율표 등에서 레시피(비율)를 선택. 위 총량·개수에 따라 필요 원소량은 자동 계산.
  2. **레시피(합성 환경) 설정** — 온도, 압력 등 조건 설정.
  3. 설정한 **성분비**와 조건을 기준으로 **IMA에 등록된 광물** 중 유사한 것을 매칭 → **광물 종(Species)** 과 **결정 구조**가 결정된다. **합성 결과 광물의 명칭은 반드시 IMA 목록을 따른다.** (강옥(Corundum), 석영(Quartz), 녹주석(Beryl) 등 IMA 공식 명칭 사용.)
  4. 그 위에 **미량 원소(Trace Elements)** 를 **추가**로 넣을 수 있다. 미량 원소는 **색상(발색)** 만 바꾼다. (고증: 발색소 이론. UI에서는 "미량 원소 첨가" 등으로 표현.)
  5. 이렇게 해서 **최종 돌**이 생성된다.
- **합성 비용:** 합성 시 **스톤(재화)** 이 소모된다. 화학적으로는 원소가 결합해 광물이 되는 반응은 많은 경우 발열(에너지 방출)이지만, **원하는 광물을 만들려면 특정 온도·압력 등 조건을 유지**해야 하고, 그 조건을 맞추고 시설(로·실험장)을 운영하는 데 **에너지(연구비)가 든다**는 설정으로 둔다.
- 유저는 **돌을 여러 개** 보유할 수 있다. 합성·경매 구매로 늘어나고, 분해·경매 판매로 줄어든다. 단, **동시에 방치 성장이 적용되는 돌은 1개**뿐이다. (위젯에 표시·성장 대상으로 선택한 1개만 시간에 따라 커짐. 나머지는 보유만 가능.)

### 생성 광물의 형태 (렌더링)

- **시각 퀄리티가 흥행의 핵심**이다. "내 돌이 얼마나 예쁜가"가 유저 이탈/유지를 좌우하므로, 결정 구조를 반영한 **심미적으로 아름다운** 렌더링(보석처럼 영롱하거나, 광물 표본처럼 사실적)이 필수이다.
- 생성되는 광물의 **형태는 절차적 생성(procedural generation)** 으로 구현한다. 매번 비슷하지만 랜덤한 느낌의 형태로 렌더링된다.
- **IMA 데이터에 있는 결정 격자 구조(crystal lattice / crystal system)** 를 반영하여 **결정 형태**가 결정된다. 즉, 광물 종류에 따른 육방정계·등축정계 등 결정계 데이터가 시각적 형태에 반영되어야 한다.
- **색상**은 위 합성 시 투입한 **미량 원소(발색소)** 에 따라 결정된다.
- 절차적 생성이기 때문에 **운이 좋으면 하트·별·이상한 비대칭** 등 특이한 모양이 나올 수 있다. 희귀성을 **직접 파라미터로 넣는 게 아니라**, 모양이 랜덤으로 나오기 때문에 **특별한 모양을 원하는 사람은 많은데 그런 모양은 잘 나오지 않아** 희소성이 생기는 것이다. 그래서 그런 형태는 수집·경매에서 프리미엄이 붙는다.
- **희귀 형태 등장 확률**은 “잘 안 나오되, 죽을 때까지 아무도 못 뽑는” 수준이면 안 된다. 일정 수 이상의 유저가 플레이 기간 내에 경험할 수 있는 수준으로 잡아야 수집·경매 동기가 유지된다.

### 분해 (Decomposition)

- 보유 중인 돌을 **분해**하면, **현재 크기(질량)** 와 **성분비**에 비례해서 **원소**로 환원된다. 키울수록 분해 시 돌아오는 원소량이 많아진다.
- **분해 비용:** 분해 시 **스톤(재화)** 이 소모된다. **실제로 광물을 원소로 분해하려면 큰 에너지가 든다.** 광물은 이미 결합된 상태(산화물·규산염 등)이므로, 이를 순수 원소로 되돌리려면 결합을 끊고 환원·분리(제련·전해 등)하는 과정이 필요하고, 그 과정에 많은 에너지 투입이 필요하다. 이걸 분해 비용의 근거로 둔다. **돌의 질량이 클수록 분해 비용이 기하급수적으로 증가**하도록 설계하여, 무분별한 "만들고 부수기"를 막고 서버 DB 부하도 줄인다.

### 악용 방지

- "몇 초만 키우고 분해 → 다시 합성 → 반복"으로 재료를 부당하게 증식시키는 행위는 **분해 비용(질량에 따른 스톤 소모)** 만으로도 충분히 억제된다. 별도의 원소 환원 손실(100% 미만 환원)은 두지 않아도 된다. 분해 시 **크기·성분비에 비례해 원소는 전량 환원**하고, 패널티는 **스톤 비용**으로만 둔다.

---

## 4. 검증 로직

- **시간 기준:** 클라이언트 시스템 시간이 아닌 **Supabase 서버 시간**을 기준으로만 질량/부피를 산출한다. 시간 조작·메모리 변조 가속 등을 원천 차단한다.
- **성장 적립 방식:** 클라이언트가 1분마다 서버에 핑을 보내지 않는다. **접속 종료 시점과 재접속 시점**을 서버가 기록하고, 그 구간의 "방치된 시간"만큼만 한 번에 계산해 성장을 적용한다. 트래픽을 극소화하면서도 치트에 강하게 유지한다.

---

## 5. 경제 및 경매 시스템 (Economy & Auction)

**"하루 한 번 열리는 블라인드 마켓"** — 서버 부하 최소화 및 공정성 확보.

- **화폐:** 경매 입찰·결제는 **인게임 화폐(스톤)만** 사용한다. 현금·외부 결제 없음.
- **수수료:** 낙찰 시 수수료를 차감한 금액만 판매자에게 지급한다. **추천: 5%** (거래 활성화와 경제 수축 방지의 균형, 스팀 마켓 등 참고).

### A. 거래 프로세스

1. **판매 등록 (Anytime):** 유저가 최소 입찰가를 설정하고 **경매 기간(1~7일)** 을 선택하여 등록. 등록 즉시 **Active**로 두고, **정산일 = 등록일 + 선택한 일수** (해당일 00:00 KST)를 DB에 저장. 맨날 등록하지 않아도 되도록 편의를 둔다.
2. **블라인드 입찰 (Active Time):**
   - **Blind:** 구매자는 현재 최고 입찰가를 볼 수 없음 (심리전).
   - **Escrow:** 입찰 즉시 스톤 차감 (취소 불가).
   - **Security:** RLS(Row Level Security) 정책으로 타인의 입찰 내역(`bids` 테이블) 조회 불가.
   - 각 매물은 **정산일**까지 입찰 가능. 기간이 1~7일로 흩어지므로 "마감 시점에 입찰 몰림"이 한날 한 시점에만 집중되지는 않는다.
3. **일괄 정산 (Daily 00:00 KST):**
   - 서버가 **정산일이 오늘인** 매물만 모아, 입찰서를 개봉하여 **[가격 > 시간]** 순으로 낙찰자 선정.
   - **성공:** 구매자에게 소유권 이전, 판매자에게 대금 지급 (수수료 제외).
   - **실패:** 패찰자에게 에스크로 된 스톤 전액 자동 반환.
   - **Data Cleaning:** 낙찰 이력만 남기고 해당 입찰 로그 삭제 (DB 용량 확보).

**참고:** 선택 범위는 **1~7일**, **기본값은 1일**로 둔다. UI에는 **힌트(설명)** 로 다음을 적어 둔다: "1일이면 다음날 00:00에 마감됩니다. 접속 요일이 다른 유저도 입찰할 수 있게 하려면 2~3일 이상을 추천합니다." (선택은 유저에게 맡김.)

### B. 경매 활성화 방안

경매가 단순 "돌 거래소"가 아니라 실제로 거래가 일어나도록 하는 설계 보완.

1. **도감 수집과 연동**
   - 도감에 **"한 번이라도 소유한 광물 종"**이 기록되게 하면, **미보유 종**을 채우기 위해 경매에서 구매할 동기가 생긴다.
   - 희귀·큰 돌이 아니어도 **광물 종이 다르면** 수요가 생기므로, "쓸모없어 보이는" 돌도 종만 다르면 팔릴 수 있게 한다. → **매물 다양성·구매 수요 동시 확보.**

   **분해 목적 구매:** 특이하거나 희귀한 **원소로 구성된 돌**이 올라오면, 그 돌을 **사서 분해해 원소를 확보**하려는 수요도 생긴다. 뽑기로는 잘 안 나오는 원소를 경매로 조달하는 경로가 되므로, 거래가 일어나는 이유가 하나 더해진다.

   **특이 형태(외형) 프리미엄:** 절차적 생성으로 가끔 **하트·별·이상한 모양** 같은 특이한 외형이 나온다. 이런 돌은 수집 욕구·과시 목적으로 **경매가가 높게 형성**될 수 있다. “희귀 외형 = 비쌀 수 있음”이면 판매자도 올려볼 동기가 생긴다.

2. **등록 인센티브**
   - **하루 1회 경매 등록 미션** 등으로 등록 시 소량 스톤/업적을 주면, "팔릴지 모르지만 올려본다"는 행동이 늘어난다.
   - 등록 수가 늘어나면 구매자도 "고를 게 많다"고 느껴 경매에 들어오기 쉬워진다.

3. **성장 시간의 가치**
   - **동시에 키울 수 있는 돌은 1개**로 제한한다. (나머지 돌은 보유만 가능, 방치 성장은 선택한 1개만 적용.) 그렇기 때문에 **이미 키워진 돌**을 사는 것이 "시간을 스킵"하는 가치가 된다.
   - "큰 돌/오래 키운 돌"에 대한 수요가 생기고, 판매자도 "키워서 올리면 된다"는 동기를 갖게 된다.

4. **미낙찰 시**
   - 입찰했으나 낙찰되지 않은 유저에게는 **에스크로된 입찰금 전액만 반환**한다. 별도 보상(스톤 추가 지급 등)은 하지 않는다. (보상 추가 시 인게임 화폐가 부당하게 증식됨)

5. **정리**
   - **도감** → 구매 수요(미보유 종) 확보.
   - **등록 인센티브(예: 일 1회 등록 미션)** → 매물 공급 증가.
   - **동시 성장 1개** → "키운 돌"의 거래 가치 부여.
   - 위 요소들을 조합해 경매 유동성과 참여도를 높인다.

---

## 6. 인게임 경제 및 원소 획득

### 화폐 단위: 스톤 (Stone)

- 인게임 화폐 단위는 **스톤**이다. 스톤을 소모해 **원소 뽑기**를 할 수 있다.

### 초기 지급

- 가입 시 **돌 1회 뽑기**를 할 수 있는 양의 스톤을 지급한다. (최초 합성용 원소를 얻을 수 있도록)

### 스톤 지급

- **일정 시간마다** 스톤이 지급된다. (구체 주기·량은 기획·밸런스)

### 스톤 소모처 (인플레이션 억제)

- **합성 비용** — 조건(온도·압력) 유지·시설 운영에 드는 연구비 명목으로 스톤 소모.
- **분해 비용** — 엔트로피 비용으로 스톤 소모(질량↑ → 비용 기하급수적).
- **원소 뽑기** — 스톤 소모.
- **경매 수수료** 5% 등. 필요 시 경매 등록비(환불 불가), 광택(Polishing) 등 **추가 소모처**를 검토할 수 있다.

### 원소 뽑기

- 스톤을 소모하여 **원소 뽑기**를 한다.
- **뽑기 결과:** IMA 레시피에 있는 **어떤 광물 하나**를 **1개 합성할 수 있는** 원소 종류와 양이 나온다. 즉, "그 돌이 어떤 돌인지는 모르는" 상태에서, 그 돌 레시피 1회분의 재료가 랜덤으로 지급된다.
- **정밀도:** 1회분 총량(300)을 비율로 나눈 원소량은 **소수점 이하 6자리**까지 저장·표시한다.
- **확률 (데이터 주도형 가중치):** 광물별 뽑기 확률은 **PM 파이/종 수 분할 + 지각 원자수비 기반 희귀 원소 페널티**로 산정한다.
  - **PM 파이 분할:** 지각 암석 비율(Rudnick & Gao)을 PM에 할당한 파이를 해당 PM 광물 종 수로 나눔 → PM47 등 종 수 과다로 인한 확률 오염 차단.
  - **희귀 원소 페널티:** 광물 구성 원소 중 지각 원자수비가 가장 낮은 원소 기준으로 가중치 감쇠 → Hg, Pb, Au 등 극미량 원소 포함 광물 출현 확률 기하급수 감소.
- **목표:** 획득 원소 분포가 지각 원자수비(O~61%, Si~23%, Al~6%)에 수렴.
- 상세는 `docs/PM_DISTRIBUTION.md` 참고.

---

## 7. 유저 플로우 요약

- **로그인/가입** → (돌 없음) 초기 스톤 지급·**원소 뽑기** → **합성**으로 첫 돌 생성.
- 돌 보유 시 **위젯**에 표시, **방치 성장** (앱 실행 중에만).
- 필요 시 **분해**로 원소 환원(스톤 비용 소모) 또는 **경매**에 매물 등록.
- **블라인드 경매**는 매일 00:00 KST 오픈, 다음날 00:00 정산. 스톤으로만 입찰·결제.

---

## 8. 용어 정리

| 용어 | 의미 |
|------|------|
| **스톤 (Stone)** | 인게임 화폐 단위. 원소 뽑기·경매 입찰에 사용. |
| **돌** | 유저가 합성/경매로 보유한 **광물**. **여러 개** 보유 가능. 위젯에 선택한 **1개**만 표시·방치 성장 적용. |
| **원소** | 합성 재료. 뽑기·분해로 획득/환원. (Fe, O 등) |
| **PM (Paragenetic Mode)** | 광물 형성 환경 분류(57종). 예: PM47 저온 풍화, PM33 열수 광상, PM11 화산 분기구. 원소 뽑기 확률(풍부도) 산정에 사용. |
| **pm_ids / gacha_weight** | `mineral_recipes`에 저장. `pm_ids`: 해당 광물이 출현하는 PM 번호 목록. `gacha_weight`: PM 파이/종 수 분할 + 희귀 원소 페널티 기반 뽑기 가중치. |
| **미량 원소 (Trace Elements)** | 구성 원소·레시피로 IMA 광물이 정해진 뒤, **추가**로 넣는 원소. 광물 종은 그대로 두고 **색상(발색)** 만 바꾼다. Cr, Fe, Ti, Mn 등. IMA 명칭은 유지(예: 강옥, 석영). |

---

## 9. 단계별 범위 (Phase)

- **1차 출시:** 로그인, 스톤 지급·원소 뽑기, 합성·분해, 위젯 방치 성장, 검증(서버 시간). (경매 없이도 플레이 가능한 최소 루프)
- **2차(이후):** 블라인드 경매(판매 등록·일괄 오픈·입찰·정산), 경매 오픈 알림, **도감**, **돌 자랑(공유·좋아요·주간 순위)** 등.
- **도감 (예정):** IMA 기준 광물 종 목록을 바탕으로, 유저가 **한 번이라도 합성·획득한** 광물을 수집·열람하는 화면. 수집 동기 부여 및 경매 수요와 연계 가능.
- **도감 업적(마일스톤):** 종이 수천 개라 전부 채우기는 비현실적이므로, **일정 개수 달성 시 업적**을 둔다. 예: 10 / 50 / 100 / 300 / 500 / 1000개 수집 시 업적 해금. 초반은 촘촘(10, 50), 이후는 듬성듬성(100, 300…)하게 구간을 잡아 중간 목표를 준다. 달성 시 **소량 스톤** 또는 **위젯/도감용 코스메틱** 보상을 주어 동기를 부여한다. 스팀/에픽 업적과 연동 가능.
- **돌 자랑(공유·좋아요·주간 순위) (예정):** 유저가 자신의 돌을 "자랑"으로 공유하면, 다른 유저가 **좋아요**를 줄 수 있고, **주간 순위**로 노출된다. **이미지 파일은 저장하지 않는다.** 돌은 절차적 생성이므로, 공유 시 **돌을 정의하는 데이터**(레시피·미량 원소·DNA/시드 등)만 DB에 저장하고, 목록/상세 보기에서 **그 데이터로 다시 렌더링**하여 보여준다. 유저가 **돌 프로필·설명**(제목, 한줄 소개, 설명 등)을 입력해 두면 그 텍스트도 함께 노출된다. (저장 비용 절감, 해상도/렌더 개선 시 과거 자랑도 동일 규칙으로 재표시 가능.)

(실제 일정에 맞춰 Phase 구간은 조정 가능)

---

## 10. 비기능 요구사항

### UI/UX (Zen)

- **기본 화면은 깨끗하게 유지한다.** 위젯에는 **돌**과 **최소한의 수치(질량/시간 등)** 만 노출한다.
- **상세 정보**는 클릭했을 때만 Inspector 등 별도 창으로 연다. 광고·구매 링크는 **기본 화면에 배치하지 않는다.**
- 제휴 링크(실물 표본 정보 등)는 **돌 상세 정보·도감 메뉴** 등 사용자가 직접 들어가는 화면의 하단에만 두고, "광고"가 아니라 **정보(Reference)** 로 느껴지게 한다.
- **로그(기록):** 뽑은 원소(뽑기 결과), 합성해서 나온 돌, 분해 결과 같은 **최근 활동 로그**를 몇 개 지원한다. 유저가 "무엇을 뽑았는지·무엇이 나왔는지"를 확인할 수 있도록 하고, 상세/연구소 등 메뉴에서 열람 가능하게 둔다. (건수·보관 기간은 구현 시 정의.)

### 저장/동기화 및 서버

- **저장/동기화:** 프로필·돌·원소·스톤 등 모든 유저 데이터는 **Supabase** 기준으로 저장·동기화한다. 단일 소스.
- **초기:** 무료 티어로 시작. 통신은 **로그인 시, 경매 접속 시, 합성·분해 시** 등 필요한 순간에만 하여 트래픽을 극소화한다. 성장은 "접속 종료~재접속" 구간만 서버가 계산하므로 상시 연결이 아니다.
- **확장:** 유저 증가로 무료 한계(MAU·DB 등)에 근접하면, $2 판매·제휴 수익으로 **Pro 요금제** 전환을 전제로 한다. 수십만 MAU를 무료로 유지할 계획은 아니며, 초기 수익이 적을 때만 무료 티어로 버티는 전략이다.
- **알림:** 경매 장 오픈(00:00 KST) 등 시점 알림이 필요하면 플랫폼(OS/스팀 등) 알림 또는 인게임 배너로 제공. (구현 범위는 Phase에서 결정)
