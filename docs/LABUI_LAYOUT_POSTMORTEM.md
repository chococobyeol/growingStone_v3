# LabUI 레이아웃 실패 회고 (재발 방지용)

## 목적
- 연구소(`LabUI`) 작업에서 같은 실수를 반복하지 않기 위한 실행 규칙 문서.
- 특히 `정렬`, `ScrollContainer`, `닫기 버튼`, `스타일 일관성` 이슈 재발 방지.

## 실제로 발생한 문제

1) 주기율표가 왼쪽 정렬로 붙음
- 증상: 가운데 정렬 의도였는데 항상 좌측에 붙어 보임.
- 실제 원인: `ScrollContainer` 직속 `GridContainer`는 기본 원점(좌상단) 배치라 중앙 정렬이 자동으로 안 됨.

2) 주기율표 상단(H/He)이 잘림
- 증상: 첫 줄 상단이 보이지 않음.
- 실제 원인: 세로 중앙 정렬 구조(`CenterContainer`)를 써서 큰 콘텐츠가 위로 밀림.

3) X 버튼이 화면을 덮거나 위치가 이상함
- 증상: 버튼이 과대 배치되거나 카드 모서리에서 벗어남.
- 실제 원인: 부모 노드 변경 후 앵커/오프셋이 의도와 다르게 적용됨.
- 해결 기준: `AuthUI`와 동일하게 루트 직속 버튼 + 카드 기준 위치 계산 함수 사용.

4) 탭/버튼 역할 혼동
- 증상: 탭 버튼이 실제 뽑기 실행을 수행.
- 실제 원인: 정보 구조(IA) 미정 상태에서 이벤트를 임시 연결.
- 해결 기준: 탭은 화면 전환, 액션은 별도 CTA 버튼.

5) 디자인 일관성 붕괴
- 증상: 폰트/색/컴포넌트 모양이 로그인 UI와 불일치.
- 실제 원인: 빠른 레이아웃 수정 과정에서 디자인 토큰 미적용.
- 해결 기준: `docs/UI_DESIGN_GUIDE.md` 토큰 우선 적용.

---

## 재발 방지 규칙 (MUST)

1. 레이아웃 구조 먼저 고정
- `ScrollContainer` 안에서
  - 세로는 top-start 고정
  - 가로 중앙이 필요하면 `HBoxContainer(alignment=center)` 래퍼를 둔다.
- `CenterContainer`로 큰 스크롤 콘텐츠 세로 정렬 금지.

2. 스크롤 기준 명확화
- 가로 중앙 시작이 필요하면:
  - 콘텐츠 폭 > 뷰포트 폭: `scroll_horizontal = (content - viewport)/2`
  - 콘텐츠 폭 <= 뷰포트 폭: 래퍼 중앙정렬로 처리 (position 수동 보정 최소화)
- 세로는 기본 `scroll_vertical = 0`으로 시작.

3. X 버튼은 AuthUI 패턴 재사용
- 루트 직속 `BtnClose` + 카드 위치 기준 `_position_close_button()` 사용.
- `NOTIFICATION_RESIZED`에서 재배치.
- 텍스트 X 사용 금지, 대각선 2개 도형 아이콘 사용.

4. 탭과 액션 분리
- 탭 버튼: 뷰 전환만.
- 실제 실행: 별도 CTA 버튼(예: 아이콘 버튼)만 담당.

5. 스타일은 토큰 우선
- 폰트: 타이틀 `온글잎`, 나머지 `IM_Hyemin`.
- 색상/버튼 스타일은 `UI_DESIGN_GUIDE.md` 팔레트 우선.

---

## 작업 순서 표준 (다음부터 이 순서로)

1) IA 확정
- 탭/CTA/결과/보유정보 역할 분리.

2) 씬 구조 확정
- 컨테이너 트리 먼저 확정하고 시각 스타일 적용.

3) 이벤트 연결
- 탭 전환, CTA 실행, 닫기 버튼 순서로 연결.

4) 정렬 검증
- 창 크기 고정/변경 각각에서
  - 좌/중앙 정렬
  - 상단 잘림
  - X 버튼 위치 확인.

5) 마지막 스타일 검증
- 로그인 UI와 폰트/색/버튼 톤 비교.

---

## 빠른 체크리스트
- [ ] 주기율표 상단(H/He) 안 잘림
- [ ] 주기율표 가로 중앙 시작
- [ ] X 버튼 카드 코너 겹침 위치 정상
- [ ] 탭은 전환만, 뽑기는 아이콘 버튼만 실행
- [ ] 폰트 매핑: 타이틀 온글잎 / 나머지 혜민체
- [ ] 색상 토큰 가이드 일치

---

## 이번 실패 과정 (실제 순서)

1) 구조보다 스타일을 먼저 만짐
- 탭/버튼 역할(탭 vs 실행 버튼) 확정 전에 스타일을 반복 수정해 재작업 발생.

2) `ScrollContainer` 정렬 원리를 잘못 적용
- `CenterContainer`를 넣었다가 상단 잘림 발생.
- 제거 후에는 좌측 정렬로 회귀.
- 결론: 스크롤 콘텐츠는 세로 top-start, 가로 중앙은 별도 래퍼/H 스크롤 계산으로 처리해야 함.

3) `X` 버튼 부모를 여러 번 변경
- 카드 자식/루트 자식을 오가며 앵커가 꼬여 화면을 가린 적이 있음.
- 결론: `AuthUI`와 같은 패턴(루트 직속 + 카드 기준 위치 계산) 고정.

4) 아이콘/버튼 상태 스타일 분리 실패
- 아이콘 테두리와 버튼 테두리가 동시에 보이며 시각적으로 어색함.
- hover/focus/pressed가 같은 스타일이거나 포커스 잔류로 효과가 안 보이는 문제 발생.

5) 런타임 오류를 UI 수정과 섞어서 대응
- 경로 오류(`StoneLabel`), 파일명 대소문자(`Main.tscn`), UID 경고 등이 남아 디버깅 비용 증가.

---

## 사용자 피드백 요약 (핵심)

- “대충 말고, 기준 파일(AuthUI)처럼 일관성 있게 맞춰라.”
- “탭은 탭 역할만, 뽑기는 별도 버튼으로.”
- “보유 원소는 텍스트 리스트가 아니라 주기율표 형태로.”
- “호버/프레스는 보여야 하고, 눌렀다 떼면 원복돼야 한다.”
- “문제 생기면 변명보다 원인을 명확히 말하고 바로 고쳐라.”

---

## 재발 방지 실행 규칙 (추가)

1. 변경 전 3문장 요약 필수
- 무엇을 고칠지, 왜 고치는지, 어떤 완료 상태인지 먼저 명시.

2. 한 번에 한 축만 수정
- 정렬/구조 수정 중에는 색/폰트를 건드리지 않음.
- 스타일 조정은 구조 안정 후에만 진행.

3. 상태 4종 검증 필수
- `normal / hover / pressed / disabled`를 모두 확인.
- `focus`는 잔류가 문제면 `normal`과 동일 또는 비활성 처리.

4. 노드 경로 변경 시 스크립트 동시 검증
- `.tscn` 노드 이동/이름 변경 직후 `@onready` 경로를 즉시 점검.

5. 완료 보고 형식 고정
- 변경 파일 2~3개
- 바꾼 수치(크기/간격/라운딩) 명시
- 아직 남은 이슈 1줄 명시

